schema: '2.0'
stages:
  preprocess:
    cmd: python src/preprocessing.py data/train.csv data/test.csv data/orders.csv
    deps:
    - path: data/orders.csv
      md5: 5c9eb03bafe45a24ea1963ef5a9620ec
      size: 134604525
    - path: data/test.csv
      md5: ef505111e05dfec9e40b8a79d751774c
      size: 1285892
    - path: data/train.csv
      md5: ee316c0b8fa103d5b40857cd1f3a860b
      size: 32218111
    - path: src/preprocessing.py
      md5: 7fc2a17a75c1d6f70370318aecea031b
      size: 852
    outs:
    - path: data/prepared
      md5: c8d0ceaf971c1107494fb2ad71e8dc78.dir
      size: 43970478
      nfiles: 2
  fit_svd:
    cmd: python src/fit_svd.py data/prepared/train_table.csv static/svd_model
    deps:
    - path: data/prepared/train_table.csv
      md5: b919e78200beedbc9ccd10a73ae18eb6
      size: 42253984
    - path: src/fit_svd.py
      md5: 90904c051221ee3fa76b73ecb1c6e940
      size: 2746
    params:
      params.yaml:
        fit_svd.n_components: 500
    outs:
    - path: static/svd_model
      md5: 42673103b9002adeccdc3dbf81db202f.dir
      size: 181562303
      nfiles: 4
  fit_top_rec:
    cmd: python src/fit_top_recommender.py data/prepared/train_table.csv static/top_rec_model
    deps:
    - path: data/prepared/train_table.csv
      md5: b919e78200beedbc9ccd10a73ae18eb6
      size: 42253984
    - path: src/fit_top_recommender.py
      md5: 0382b80c6f3c34eed74ccc076aadfbcd
      size: 597
    outs:
    - path: static/top_rec_model
      md5: fb9949fd156d5106870370e1e5960e96.dir
      size: 247473
      nfiles: 1
  predict_svd:
    cmd: "python src/predict_svd.py data/prepared/test_table.csv static/svd_model/users_repres.npy\
      \ static/svd_model/products_repres.npy static/svd_model/user_pos.json static/svd_model/pos_product.json\
      \ static/recs/svd\n"
    deps:
    - path: src/predict_svd.py
      md5: e484fd945610deb26adebec577f0b630
      size: 2478
    - path: static/svd_model
      md5: 42673103b9002adeccdc3dbf81db202f.dir
      size: 181562303
      nfiles: 4
    params:
      params.yaml:
        predict_svd.batch_number: 120
        predict_svd.n_recs: 10
    outs:
    - path: static/recs/svd/svd_metrics.json
      md5: d3992e6ea7306412c3a45a4bcf61633d
      size: 162
    - path: static/recs/svd/svd_metrics.txt
      md5: 93ee10c6b0933316a7a17e7cefcc41e3
      size: 144
    - path: static/recs/svd/svd_recs.csv
      md5: 314cc06459ce5c1e7be1e5d3fa6c5f36
      size: 533020
  predict_top:
    cmd: "python src/predict_top.py data/prepared/test_table.csv static/top_rec_model/model.pickle\
      \ static/recs/top\n"
    deps:
    - path: src/predict_top.py
      md5: c84ab0bd4fd0749fcc54be46062a923e
      size: 1374
    - path: static/top_rec_model
      md5: fb9949fd156d5106870370e1e5960e96.dir
      size: 247473
      nfiles: 1
    params:
      params.yaml:
        predict_top.n_recs: 10
    outs:
    - path: static/recs/top/top_metrics.json
      md5: 41e1c4435f0b4c820411f30a41af5bf6
      size: 162
    - path: static/recs/top/top_metrics.txt
      md5: ff8be895e79c75db10916b0d4ba62c95
      size: 144
    - path: static/recs/top/top_recs.csv
      md5: 55d835933389bbf1da0531058cbd7ef4
      size: 543778
